<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>VT ETF æŠ•è³‡ç†è²¡æ¨¡æ“¬å™¨ - æ”¹è‰¯ç‰ˆ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { 
    font-family: "å¾®è»Ÿæ­£é»‘é«”", -apple-system, BlinkMacSystemFont, sans-serif; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    margin: 0;
}
#game { 
    max-width: 1200px; 
    margin: auto; 
    background: #fff; 
    padding: 30px; 
    border-radius: 16px; 
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
}
h2 {
    color: #333;
    border-bottom: 3px solid #667eea;
    padding-bottom: 10px;
}
.status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}
.status-card {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.status-card h4 {
    margin: 0 0 10px 0;
    color: #667eea;
    font-size: 14px;
}
.status-card .value {
    font-size: 20px;
    font-weight: bold;
    color: #333;
}
.profit { color: #4caf50; }
.loss { color: #f44336; }
button { 
    margin: 5px; 
    padding: 10px 20px; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
    font-weight: 500;
}
button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
#pauseBtn { background: #ff5722; color: #fff; }
#resumeBtn { background: #4caf50; color: #fff; }
#speedControl { background: #2196F3; color: #fff; }
.control-panel {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
}
.input-group {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin: 15px 0;
}
.input-group label {
    display: flex;
    flex-direction: column;
    gap: 5px;
    font-weight: 500;
    color: #555;
}
.input-group input[type=number] { 
    width: 150px;
    padding: 8px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
}
.input-group input[type=number]:focus {
    border-color: #667eea;
    outline: none;
}
#applyBtn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 30px;
}
#log { 
    white-space: pre-line; 
    margin-top: 20px; 
    height: 200px; 
    overflow-y: auto; 
    border: 2px solid #e0e0e0; 
    padding: 15px; 
    border-radius: 10px; 
    background: #fafafa;
    font-family: 'Courier New', monospace;
    font-size: 13px;
}
.chart-container {
    margin-top: 30px;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
.tab {
    padding: 8px 16px;
    background: #e0e0e0;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
}
.tab.active {
    background: #667eea;
    color: white;
}
.events-section {
    margin-top: 20px;
}
.event-notice {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
    padding: 10px;
    margin: 10px 0;
    border-radius: 6px;
}
.speed-indicator {
    display: inline-block;
    margin-left: 10px;
    padding: 5px 10px;
    background: #e3f2fd;
    border-radius: 5px;
    font-size: 12px;
}
</style>
</head>
<body>
<div id="game">
<h2>ğŸ¯ VT ETF æŠ•è³‡ç†è²¡æ¨¡æ“¬å™¨ - æ”¹è‰¯ç‰ˆ</h2>

<div class="status-grid" id="statusGrid"></div>

<div class="control-panel">
    <h3>âš™ï¸ æ§åˆ¶é¢æ¿</h3>
    <div style="margin-bottom: 15px;">
        <button id="pauseBtn">â¸ï¸ æš«åœæ™‚é–“</button>
        <button id="resumeBtn">â–¶ï¸ ç¹¼çºŒæ™‚é–“</button>
        <button id="speedControl">âš¡ åŠ é€Ÿæ¨¡å¼</button>
        <span class="speed-indicator" id="speedIndicator">é€Ÿåº¦: 1x</span>
    </div>
    
    <div class="input-group">
        <label>
            ğŸ’° æ¯æœˆè–ªæ°´
            <input type="number" id="salaryInput" value="60000">
        </label>
        <label>
            ğŸ“Š å›ºå®šæ”¯å‡º
            <input type="number" id="expenseInput" value="35000">
        </label>
        <label>
            ğŸ“ˆ æœ¬æœˆæŠ•è³‡é‡‘é¡
            <input type="number" id="investInput" value="10000" min="0">
        </label>
        <label>
            ğŸ è‡¨æ™‚æ”¶å…¥
            <input type="number" id="bonusInput" value="0" min="0">
        </label>
    </div>
    <button id="applyBtn">âœ… ç¢ºèªæ±ºç­–</button>
    <button id="withdrawBtn" style="background: #ff9800; color: white;">ğŸ’¸ è´–å›æŠ•è³‡</button>
</div>

<div class="events-section" id="eventsSection"></div>

<div class="chart-container">
    <div class="tabs">
        <div class="tab active" onclick="switchChart('wealth')">ğŸ’ æ·¨å€¼è®ŠåŒ–</div>
        <div class="tab" onclick="switchChart('allocation')">ğŸ“Š è³‡ç”¢é…ç½®</div>
        <div class="tab" onclick="switchChart('performance')">ğŸ“ˆ æŠ•è³‡ç¸¾æ•ˆ</div>
    </div>
    <canvas id="moneyChart" height="100"></canvas>
</div>

<div id="log"><strong>ğŸ“ æ­·å²è¨˜éŒ„ï¼š</strong></div>
</div>

<script>
// æ›´çœŸå¯¦çš„ VT ETF æ­·å²æœˆå ±é…¬ç‡æ•¸æ“šï¼ˆåŸºæ–¼å¯¦éš›æ­·å²æ•¸æ“šçš„æ¨¡æ“¬ï¼‰
const historicalReturns = [
    0.0312, -0.0189, 0.0245, -0.0078, 0.0156, -0.0234, 0.0189, 0.0067,
    -0.0145, 0.0298, 0.0087, -0.0056, 0.0223, -0.0112, 0.0345, -0.0423,
    0.0198, 0.0134, -0.0089, 0.0267, -0.0034, 0.0156, 0.0089, -0.0198,
    0.0412, -0.0567, 0.0234, 0.0178, -0.0023, 0.0145, 0.0089, -0.0134
];

// ç”Ÿå‘½äº‹ä»¶ç³»çµ±
const lifeEvents = [
    { age: 30, type: 'marriage', name: 'çµå©š', cost: 500000, description: 'æ­å–œçµå©šï¼å©šç¦®æ”¯å‡º' },
    { age: 32, type: 'child', name: 'ç”Ÿå°å­©', cost: 100000, monthlyExpense: 15000, description: 'æ­å–œè¿æ¥æ–°ç”Ÿå‘½ï¼è‚²å…’æ”¯å‡ºå¢åŠ ' },
    { age: 35, type: 'house', name: 'è²·æˆ¿', cost: 2000000, description: 'è³¼è²·è‡ªä½æˆ¿ç”¢ï¼Œé ­æœŸæ¬¾æ”¯å‡º' },
    { age: 40, type: 'promotion', name: 'å‡è·', salaryIncrease: 20000, description: 'è·å ´æ™‰å‡ï¼è–ªè³‡å¢åŠ ' },
    { age: 45, type: 'medical', name: 'é†«ç™‚æ”¯å‡º', cost: 300000, description: 'å®¶äººé†«ç™‚è²»ç”¨' },
    { age: 50, type: 'education', name: 'å­å¥³æ•™è‚²', cost: 500000, description: 'å­å¥³å¤§å­¸æ•™è‚²åŸºé‡‘' }
];

// å¸‚å ´äº‹ä»¶
const marketEvents = [
    { probability: 0.05, type: 'crash', name: 'è‚¡å¸‚å´©ç›¤', impact: -0.30, description: 'å…¨çƒé‡‘èå±æ©Ÿï¼' },
    { probability: 0.10, type: 'correction', name: 'å¸‚å ´ä¿®æ­£', impact: -0.15, description: 'å¸‚å ´é€²å…¥ä¿®æ­£éšæ®µ' },
    { probability: 0.15, type: 'bull', name: 'ç‰›å¸‚', impact: 0.20, description: 'ç‰›å¸‚ä¾†è‡¨ï¼æŠ•è³‡å¤§å¹…æˆé•·' },
    { probability: 0.03, type: 'blackswan', name: 'é»‘å¤©éµ', impact: -0.40, description: 'é»‘å¤©éµäº‹ä»¶ç™¼ç”Ÿï¼' }
];

// ç©å®¶ç‹€æ…‹
let player = {
    name: "ç©å®¶",
    age: 25,
    month: 1,
    salary: 60000,
    basicExpense: 35000,
    money: 200000,
    investCash: 0,
    monthlyInvest: 10000,
    investCost: 0,
    totalMonths: 0,
    bonusIncome: 0,
    lifeStage: 'å–®èº«',
    retireAge: 65,
    fireTarget: 10000000 // FIRE ç›®æ¨™
};

let history = {
    money: [player.money],
    investHistory: [0],
    months: [1],
    events: [],
    monthlyReturns: []
};

let gameSpeed = 1;
let interval = null;
let currentChartType = 'wealth';

// DOM å…ƒç´ 
const logEl = document.getElementById("log");
const statusGrid = document.getElementById("statusGrid");
const eventsSection = document.getElementById("eventsSection");
const speedIndicator = document.getElementById("speedIndicator");

// æ ¼å¼åŒ–é‡‘é¡
function formatMoney(amount) {
    return 'NT$' + Math.round(amount).toLocaleString();
}

// æ ¼å¼åŒ–ç™¾åˆ†æ¯”
function formatPercent(value) {
    return (value > 0 ? '+' : '') + value.toFixed(2) + '%';
}

// è¨˜éŒ„åŠŸèƒ½
function log(text, type = 'info') {
    const time = `[${player.age}æ­²${player.month}æœˆ]`;
    const prefix = type === 'event' ? 'ğŸ‰ ' : type === 'warning' ? 'âš ï¸ ' : 'ğŸ“ ';
    logEl.innerText = `${time} ${prefix}${text}\n` + logEl.innerText;
}

// æ›´æ–°ç‹€æ…‹é¡¯ç¤º
function updateStatus() {
    const netWorth = player.money + player.investCash;
    const investProfit = player.investCash - player.investCost;
    const investProfitRate = player.investCost > 0 ? (investProfit / player.investCost * 100) : 0;
    const monthlyFlow = player.salary - player.basicExpense - player.monthlyInvest;
    const fireProgress = (netWorth / player.fireTarget * 100).toFixed(1);
    const yearsToRetire = player.retireAge - player.age;
    
    statusGrid.innerHTML = `
        <div class="status-card">
            <h4>ğŸ‘¤ åŸºæœ¬è³‡è¨Š</h4>
            <div class="value">${player.age} æ­² ${player.month} æœˆ</div>
            <small>${player.lifeStage}</small>
        </div>
        <div class="status-card">
            <h4>ğŸ’° ç¾é‡‘</h4>
            <div class="value">${formatMoney(player.money)}</div>
        </div>
        <div class="status-card">
            <h4>ğŸ“ˆ æŠ•è³‡è³‡ç”¢</h4>
            <div class="value">${formatMoney(player.investCash)}</div>
            <small>æˆæœ¬: ${formatMoney(player.investCost)}</small>
        </div>
        <div class="status-card">
            <h4>ğŸ’ ç¸½æ·¨å€¼</h4>
            <div class="value">${formatMoney(netWorth)}</div>
        </div>
        <div class="status-card">
            <h4>ğŸ“Š æŠ•è³‡å ±é…¬</h4>
            <div class="value ${investProfit >= 0 ? 'profit' : 'loss'}">${formatMoney(investProfit)}</div>
            <small>${formatPercent(investProfitRate)}</small>
        </div>
        <div class="status-card">
            <h4>ğŸ’¸ æœˆç¾é‡‘æµ</h4>
            <div class="value ${monthlyFlow >= 0 ? 'profit' : 'loss'}">${formatMoney(monthlyFlow)}</div>
        </div>
        <div class="status-card">
            <h4>ğŸ”¥ FIRE é€²åº¦</h4>
            <div class="value">${fireProgress}%</div>
            <small>ç›®æ¨™: ${formatMoney(player.fireTarget)}</small>
        </div>
        <div class="status-card">
            <h4>â° è·é›¢é€€ä¼‘</h4>
            <div class="value">${yearsToRetire} å¹´</div>
        </div>
    `;
}

// Chart.js è¨­å®š
const ctx = document.getElementById("moneyChart").getContext("2d");
let moneyChart = new Chart(ctx, {
    type: "line",
    data: {
        labels: ['é–‹å§‹'],
        datasets: [{
            label: "ç¸½æ·¨å€¼",
            data: [player.money + player.investCash],
            borderColor: "#667eea",
            backgroundColor: "rgba(102, 126, 234, 0.1)",
            fill: true,
            tension: 0.3
        }, {
            label: "æŠ•è³‡è³‡ç”¢",
            data: [0],
            borderColor: "#4caf50",
            backgroundColor: "rgba(76, 175, 80, 0.1)",
            fill: true,
            tension: 0.3
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: true,
                position: 'top'
            },
            tooltip: {
                mode: 'index',
                intersect: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: value => formatMoney(value)
                }
            }
        }
    }
});

// åˆ‡æ›åœ–è¡¨
function switchChart(type) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    event.target.classList.add('active');
    
    if (type === 'allocation') {
        moneyChart.destroy();
        moneyChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['ç¾é‡‘', 'æŠ•è³‡'],
                datasets: [{
                    data: [player.money, player.investCash],
                    backgroundColor: ['#ff9800', '#4caf50']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    } else if (type === 'performance') {
        moneyChart.destroy();
        moneyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: history.months.slice(-12).map(m => `M${m}`),
                datasets: [{
                    label: 'æœˆå ±é…¬ç‡',
                    data: history.monthlyReturns.slice(-12),
                    backgroundColor: history.monthlyReturns.slice(-12).map(r => r >= 0 ? '#4caf50' : '#f44336')
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        ticks: {
                            callback: value => formatPercent(value * 100)
                        }
                    }
                }
            }
        });
    } else {
        location.reload(); // ç°¡å–®é‡è¼‰ä»¥é‡ç½®åœ–è¡¨
    }
    currentChartType = type;
}

// æ¸²æŸ“æ“ä½œé¢æ¿
function renderActions() {
    document.getElementById("salaryInput").value = player.salary;
    document.getElementById("expenseInput").value = player.basicExpense;
    document.getElementById("investInput").value = player.monthlyInvest;
    document.getElementById("bonusInput").value = 0;
}

// æ‡‰ç”¨æ±ºç­–
function applyDecisions() {
    const salary = parseFloat(document.getElementById("salaryInput").value) || 0;
    const expense = parseFloat(document.getElementById("expenseInput").value) || 0;
    const monthlyInvest = parseFloat(document.getElementById("investInput").value) || 0;
    const bonus = parseFloat(document.getElementById("bonusInput").value) || 0;

    if (monthlyInvest < 0) {
        alert("æŠ•è³‡é‡‘é¡ä¸èƒ½ç‚ºè² æ•¸");
        return;
    }
    
    const totalAvailable = player.money + bonus;
    if (monthlyInvest > totalAvailable) {
        alert(`æŠ•è³‡é‡‘é¡ä¸èƒ½è¶…éå¯ç”¨è³‡é‡‘ ${formatMoney(totalAvailable)}`);
        return;
    }

    player.salary = salary;
    player.basicExpense = expense;
    player.monthlyInvest = monthlyInvest;
    player.bonusIncome = bonus;

    log(`æ±ºç­–æ›´æ–° - è–ªæ°´: ${formatMoney(salary)}, æ”¯å‡º: ${formatMoney(expense)}, æŠ•è³‡: ${formatMoney(monthlyInvest)}${bonus > 0 ? ', è‡¨æ™‚æ”¶å…¥: ' + formatMoney(bonus) : ''}`);
    updateStatus();
}

// è´–å›æŠ•è³‡
document.getElementById("withdrawBtn").addEventListener("click", function() {
    const amount = prompt(`è«‹è¼¸å…¥è´–å›é‡‘é¡ (å¯è´–å›: ${formatMoney(player.investCash)})`);
    if (amount && !isNaN(amount)) {
        const withdrawAmount = Math.min(parseFloat(amount), player.investCash);
        if (withdrawAmount > 0) {
            player.investCash -= withdrawAmount;
            player.money += withdrawAmount;
            player.investCost = Math.max(0, player.investCost - withdrawAmount);
            log(`è´–å›æŠ•è³‡ ${formatMoney(withdrawAmount)}`, 'event');
            updateStatus();
            updateChart();
        }
    }
});

// æª¢æŸ¥ç”Ÿå‘½äº‹ä»¶
function checkLifeEvents() {
    lifeEvents.forEach(event => {
        if (player.age === event.age && player.month === 1) {
            handleLifeEvent(event);
        }
    });
}

// è™•ç†ç”Ÿå‘½äº‹ä»¶
function handleLifeEvent(event) {
    let eventHtml = `<div class="event-notice">ğŸŠ ${event.description}</div>`;
    eventsSection.innerHTML = eventHtml;
    setTimeout(() => eventsSection.innerHTML = '', 5000);
    
    if (event.cost) {
        player.money -= event.cost;
        log(`${event.name}: æ”¯å‡º ${formatMoney(event.cost)}`, 'event');
    }
    if (event.monthlyExpense) {
        player.basicExpense += event.monthlyExpense;
        log(`æ¯æœˆæ”¯å‡ºå¢åŠ  ${formatMoney(event.monthlyExpense)}`, 'event');
    }
    if (event.salaryIncrease) {
        player.salary += event.salaryIncrease;
        log(`è–ªè³‡èª¿å‡è‡³ ${formatMoney(player.salary)}`, 'event');
    }
    
    // æ›´æ–°ç”Ÿæ´»éšæ®µ
    if (event.type === 'marriage') player.lifeStage = 'å·²å©š';
    if (event.type === 'child') player.lifeStage = 'æœ‰å°å­©';
    if (event.type === 'house') player.lifeStage = 'æœ‰æˆ¿ç”¢';
}

// æª¢æŸ¥å¸‚å ´äº‹ä»¶
function checkMarketEvents() {
    marketEvents.forEach(event => {
        if (Math.random() < event.probability / 12) {
            handleMarketEvent(event);
        }
    });
}

// è™•ç†å¸‚å ´äº‹ä»¶
function handleMarketEvent(event) {
    const impact = Math.floor(player.investCash * event.impact);
    player.investCash += impact;
    
    let eventHtml = `<div class="event-notice" style="border-color: ${event.impact > 0 ? '#4caf50' : '#f44336'}">
        ğŸ“ˆ ${event.description} æŠ•è³‡ ${event.impact > 0 ? 'å¢å€¼' : 'è™§æ'} ${formatMoney(Math.abs(impact))}
    </div>`;
    eventsSection.innerHTML = eventHtml;
    setTimeout(() => eventsSection.innerHTML = '', 5000);
    
    log(`${event.name}: æŠ•è³‡${event.impact > 0 ? 'ç²åˆ©' : 'è™§æ'} ${formatMoney(Math.abs(impact))}`, 'event');
}

// æ¯æœˆè¨ˆç®—
function nextMonth() {
    player.totalMonths++;
    
    // å¹´åº¦èª¿è–ª (3-5%)
    if (player.month === 1 && player.age > 25) {
        const raise = 0.03 + Math.random() * 0.02;
        player.salary = Math.floor(player.salary * (1 + raise));
        log(`å¹´åº¦èª¿è–ª ${formatPercent(raise * 100)} è‡³ ${formatMoney(player.salary)}`);
    }
    
    // å¹´çµ‚çé‡‘
    if (player.month === 12) {
        const yearBonus = player.salary * (1 + Math.random());
        player.money += yearBonus;
        log(`å¹´çµ‚çé‡‘ ${formatMoney(yearBonus)}`, 'event');
    }
    
    // æ”¶å…¥èˆ‡æ”¯å‡º
    const totalIncome = player.salary + player.bonusIncome;
    const totalExpense = player.basicExpense;
    const investThisMonth = Math.min(player.monthlyInvest, player.money);
    
    // VT ETF æŠ•è³‡å ±é…¬
    const returnIndex = Math.floor(Math.random() * historicalReturns.length);
    const monthlyReturn = historicalReturns[returnIndex];
    const investReturn = Math.floor(player.investCash * monthlyReturn);
    
    // è¤‡åˆ©æ•ˆæœ
    const dividends = Math.floor(player.investCash * 0.002); // ç´„ 2.4% å¹´è‚¡æ¯
    
    // æ›´æ–°è³‡ç”¢
    player.money += totalIncome - totalExpense - investThisMonth + dividends;
    player.investCash += investThisMonth + investReturn;
    player.investCost += investThisMonth;
    
    // æª¢æŸ¥ç”Ÿå‘½èˆ‡å¸‚å ´äº‹ä»¶
    checkLifeEvents();
    if (player.totalMonths % 3 === 0) checkMarketEvents(); // æ¯å­£æª¢æŸ¥å¸‚å ´äº‹ä»¶
    
    // æ›´æ–°æœˆä»½
    if (player.month === 12) {
        player.age++;
        player.month = 1;
    } else {
        player.month++;
    }
    
    // è¨˜éŒ„æ­·å²
    const netWorth = player.money + player.investCash;
    history.money.push(netWorth);
    history.investHistory.push(player.investCash);
    history.months.push(player.totalMonths);
    history.monthlyReturns.push(monthlyReturn);
    
    // æ›´æ–°åœ–è¡¨
    updateChart();
    
    // æ›´æ–°ç‹€æ…‹
    updateStatus();
    
    // è¨˜éŒ„
    const returnStr = monthlyReturn >= 0 ? `+${formatPercent(monthlyReturn * 100)}` : formatPercent(monthlyReturn * 100);
    log(`æŠ•è³‡ ${formatMoney(investThisMonth)}, å ±é…¬ ${returnStr}, æ·¨å€¼ ${formatMoney(netWorth)}`);
    
    // æª¢æŸ¥ FIRE é”æˆ
    if (netWorth >= player.fireTarget) {
        log(`ğŸ‰ æ­å–œé”æˆ FIRE ç›®æ¨™ï¼ç¸½è³‡ç”¢ ${formatMoney(netWorth)}`, 'event');
        pauseTimeFlow();
        alert(`æ­å–œï¼æ‚¨åœ¨ ${player.age} æ­²é”æˆè²¡å‹™è‡ªç”±ç›®æ¨™ï¼`);
    }
    
    // æª¢æŸ¥ç ´ç”¢
    if (player.money < 0 && player.investCash <= 0) {
        log(`âš ï¸ ç ´ç”¢è­¦å‘Šï¼è«‹èª¿æ•´è²¡å‹™ç­–ç•¥`, 'warning');
        pauseTimeFlow();
    }
    
    // æ¸…é™¤è‡¨æ™‚æ”¶å…¥
    player.bonusIncome = 0;
}

// æ›´æ–°åœ–è¡¨
function updateChart() {
    if (currentChartType !== 'wealth') return;
    
    const label = `${player.age}æ­²${player.month}æœˆ`;
    moneyChart.data.labels.push(label);
    moneyChart.data.datasets[0].data.push(player.money + player.investCash);
    moneyChart.data.datasets[1].data.push(player.investCash);
    
    // é™åˆ¶é¡¯ç¤ºé»æ•¸
    if (moneyChart.data.labels.length > 50) {
        moneyChart.data.labels.shift();
        moneyChart.data.datasets[0].data.shift();
        moneyChart.data.datasets[1].data.shift();
    }
    
    moneyChart.update();
}

// æ™‚é–“æ§åˆ¶
function startTimeFlow() {
    if (interval) return;
    const speed = gameSpeed === 1 ? 1000 : gameSpeed === 2 ? 500 : 200;
    interval = setInterval(nextMonth, speed);
}

function pauseTimeFlow() {
    clearInterval(interval);
    interval = null;
}

// é€Ÿåº¦æ§åˆ¶
document.getElementById("speedControl").addEventListener("click", function() {
    gameSpeed = gameSpeed === 1 ? 2 : gameSpeed === 2 ? 4 : 1;
    speedIndicator.textContent = `é€Ÿåº¦: ${gameSpeed}x`;
    if (interval) {
        pauseTimeFlow();
        startTimeFlow();
    }
});

// äº‹ä»¶ç›£è½
document.getElementById("pauseBtn").addEventListener("click", pauseTimeFlow);
document.getElementById("resumeBtn").addEventListener("click", startTimeFlow);
document.getElementById("applyBtn").addEventListener("click", applyDecisions);

// åˆå§‹åŒ–
updateStatus();
renderActions();
log("éŠæˆ²é–‹å§‹ï¼25æ­²çš„ä½ é–‹å§‹æŠ•è³‡ç†è²¡ä¹‹æ—…");
startTimeFlow();
</script>
</body>
</html>
